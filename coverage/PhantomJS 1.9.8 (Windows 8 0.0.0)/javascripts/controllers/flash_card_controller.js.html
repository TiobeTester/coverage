<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for javascripts\controllers\flash_card_controller.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">javascripts/controllers/</a> flash_card_controller.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.33% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>59/60</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">81.82% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>18/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">93.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">98.33% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>59/60</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">20×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">Psr.controller('FlashCardCtrl', function ($mdDialog, session, $scope, metric, time, configuration) { // jscs:ignore maximumLineLength
    $scope.originalData = angular.copy(metric);
    $scope.originalEvidence = angular.copy(metric.evidence);
    $scope.metric = metric;
    $scope.showEvidence = false;
    $scope.evidence = prepareEvidence(metric);
    $scope.person = session.getSessionData();
&nbsp;
    $scope.changed = false;
    $scope.metricName = metric.name;
    $scope.flipped = false;
    $scope.utcToLocal = time.utcToLocal;
&nbsp;
    $scope.cancel = function () {
        if (hasAnyChanges()) {
            $scope.flipped = !$scope.flipped;
        } else {
            $mdDialog.cancel();
        }
    };
&nbsp;
    $scope.save = function () {
        var repEntity = session.getSelectedReportingEntity();
        $mdDialog.hide({
            // jscs:disable requireCamelCaseOrUpperCaseIdentifiers
            score: hasAnyChanges() ? {
                metric_id: $scope.metric.id,
                id: $scope.metric.score_id,
                score: $scope.metric.score,
                comments: $scope.metric.comments,
                squad_id: repEntity.type === 'Squad' ? repEntity.id : <span class="branch-1 cbranch-no" title="branch not covered" >null,</span>
                unit_id: repEntity.type === 'Unit' ? <span class="branch-0 cbranch-no" title="branch not covered" >repEntity.id </span>: null
            } : <span class="branch-1 cbranch-no" title="branch not covered" >null,</span>
            // jscs:enable
            evidence: hasEvidenceChanges() ? <span class="branch-0 cbranch-no" title="branch not covered" >$scope.evidence </span>: []
        });
    };
&nbsp;
    $scope.no = function () {
        $scope.flipped = false;
    };
&nbsp;
    $scope.yes = function () {
        $mdDialog.cancel();
    };
&nbsp;
    $scope.toggleShowEvidences = function () {
        $scope.showEvidence = !$scope.showEvidence;
        $scope.changed = hasAnyChanges();
    };
&nbsp;
    $scope.$watchGroup(['metric.score', 'metric.comments'], function () {
        $scope.changed = hasAnyChanges();
    }, true);
&nbsp;
    $scope.$on('paste-clipboard', function (event, args) {
        $scope.handlePaste(args);
    });
&nbsp;
    $scope.handlePaste = function (e) {
        for (var i = 0; i &lt; e.clipboardData.items.length; i++) {
            var item = e.clipboardData.items[i];
            if (item.type.indexOf('image') !== -1) {
                $scope.evidence.push({
                    image: item.getAsFile(),
                    comments: '',
                    imageUrl: $scope.getBlobUrl(item.getAsFile())
                });
            } else {
                console.log('Discarding non-image paste data');
            }
        }
    };
&nbsp;
    $scope.getBlobUrl = <span class="fstat-no" title="function not covered" >function (blob) {</span>
<span class="cstat-no" title="statement not covered" >        return window.URL.createObjectURL(blob);</span>
    };
&nbsp;
    function hasAnyChanges() {
        return hasEvidenceChanges() || hasFlashCardChanges();
    }
&nbsp;
    function hasEvidenceChanges() {
        for (var i = 0; i &lt; $scope.originalEvidence.length; i++) {
            if ($scope.originalEvidence[i].comments !== $scope.evidence[i].comments ||
                $scope.evidence[i].isDeleted === true) {
                return true;
            }
        }
&nbsp;
        for (; i &lt; $scope.evidence.length; i++) {
            if (!$scope.evidence[i].isDeleted) {
                return true;
            }
        }
        return false;
    }
&nbsp;
    function hasFlashCardChanges() {
        var hasScoreChanges = !angular.equals($scope.originalData.score, $scope.metric.score);
        var hasCommentsChanges = !angular.equals($scope.originalData.comments, $scope.metric.comments);
        return hasScoreChanges || hasCommentsChanges;
    }
&nbsp;
    function prepareEvidence(metric) {
        var url = configuration.getApiUrl();
        // jscs:disable requireCamelCaseOrUpperCaseIdentifiers
        for (var i = 0; i &lt; metric.evidence.length; i++) {
            metric.evidence[i].imageUrl = url + metric.evidence[i].image_url;
            metric.evidence[i].thumbnail_url = url + metric.evidence[i].thumbnail_url;
            metric.evidence[i].image_url = url + metric.evidence[i].image_url;
        }
        // jscs:enable
        return metric.evidence;
    }
&nbsp;
    $scope.toggleRemove = function (evidence) {
        evidence.isDeleted = !evidence.isDeleted;
    };
});
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Mar 22 2016 12:00:40 GMT+0100 (W. Europe Standard Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
